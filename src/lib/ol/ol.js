(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory(require("ol/control/control"),require("ol/observable")):typeof define==="function"&&define.amd?define(["ol/control/control","ol/observable"],factory):(global.LayerSwitcher=factory(global.ol.control.Control,global.ol.Observable))}(this,(function(Control,Observable){Control="default" in Control?Control["default"]:Control;Observable="default" in Observable?Observable["default"]:Observable;var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor){descriptor.writable=true}Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps){defineProperties(Constructor.prototype,protoProps)}if(staticProps){defineProperties(Constructor,staticProps)}return Constructor}}();var get=function get(object,property,receiver){if(object===null){object=Function.prototype}var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else{if("value" in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};var inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass){Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}};var possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self};var LayerSwitcher=function(_Control){inherits(LayerSwitcher,_Control);function LayerSwitcher(opt_options){classCallCheck(this,LayerSwitcher);var options=opt_options||{};var tipLabel=options.tipLabel?options.tipLabel:"Legend";var element=document.createElement("div");var _this=possibleConstructorReturn(this,(LayerSwitcher.__proto__||Object.getPrototypeOf(LayerSwitcher)).call(this,{element:element,target:options.target}));_this.mapListeners=[];_this.hiddenClassName="ol-unselectable ol-control layer-switcher";if(LayerSwitcher.isTouchDevice_()){_this.hiddenClassName+=" touch"}_this.shownClassName="shown";element.className=_this.hiddenClassName;var button=document.createElement("button");button.setAttribute("title",tipLabel);element.appendChild(button);_this.panel=document.createElement("div");_this.panel.className="panel";element.appendChild(_this.panel);LayerSwitcher.enableTouchScroll_(_this.panel);var this_=_this;button.onmouseover=function(e){this_.showPanel()};button.onclick=function(e){e=e||window.event;this_.showPanel();e.preventDefault()};this_.panel.onmouseout=function(e){e=e||window.event;if(!this_.panel.contains(e.toElement||e.relatedTarget)){this_.hidePanel()}};return _this}createClass(LayerSwitcher,[{key:"setMap",value:function setMap(map){for(var i=0,key;i<this.mapListeners.length;i++){Observable.unByKey(this.mapListeners[i])}this.mapListeners.length=0;get(LayerSwitcher.prototype.__proto__||Object.getPrototypeOf(LayerSwitcher.prototype),"setMap",this).call(this,map);if(map){var this_=this;this.mapListeners.push(map.on("pointerdown",function(){this_.hidePanel()}));this.renderPanel()}}},{key:"showPanel",value:function showPanel(){if(!this.element.classList.contains(this.shownClassName)){this.element.classList.add(this.shownClassName);this.renderPanel()}}},{key:"hidePanel",value:function hidePanel(){if(this.element.classList.contains(this.shownClassName)){this.element.classList.remove(this.shownClassName)}}},{key:"renderPanel",value:function renderPanel(){this.ensureTopVisibleBaseLayerShown_();while(this.panel.firstChild){this.panel.removeChild(this.panel.firstChild)}var ul=document.createElement("ul");this.panel.appendChild(ul);this.renderLayers_(this.getMap(),ul)}},{key:"ensureTopVisibleBaseLayerShown_",value:function ensureTopVisibleBaseLayerShown_(){var lastVisibleBaseLyr;LayerSwitcher.forEachRecursive(this.getMap(),function(l,idx,a){if(l.get("type")==="base"&&l.getVisible()){lastVisibleBaseLyr=l}});if(lastVisibleBaseLyr){this.setVisible_(lastVisibleBaseLyr,true)}}},{key:"setVisible_",value:function setVisible_(lyr,visible){var map=this.getMap();lyr.setVisible(visible);if(visible&&lyr.get("type")==="base"){LayerSwitcher.forEachRecursive(map,function(l,idx,a){if(l!=lyr&&l.get("type")==="base"){l.setVisible(false)
}})}}},{key:"renderLayer_",value:function renderLayer_(lyr,idx){var this_=this;var li=document.createElement("li");var lyrTitle=lyr.get("title");var lyrId=LayerSwitcher.uuid();var label=document.createElement("label");if(lyr.getLayers&&!lyr.get("combine")){li.className="group";label.innerHTML=lyrTitle;li.appendChild(label);var ul=document.createElement("ul");li.appendChild(ul);this.renderLayers_(lyr,ul)}else{li.className="layer";var input=document.createElement("input");if(lyr.get("type")==="base"){input.type="radio";input.name="base"}else{input.type="checkbox"}input.id=lyrId;input.checked=lyr.get("visible");input.onchange=function(e){this_.setVisible_(lyr,e.target.checked)};li.appendChild(input);label.htmlFor=lyrId;label.innerHTML=lyrTitle;var rsl=this.getMap().getView().getResolution();if(rsl>lyr.getMaxResolution()||rsl<lyr.getMinResolution()){label.className+=" disabled"}li.appendChild(label)}return li}},{key:"renderLayers_",value:function renderLayers_(lyr,elm){var lyrs=lyr.getLayers().getArray().slice().reverse();for(var i=0,l;i<lyrs.length;i++){l=lyrs[i];if(l.get("title")){elm.appendChild(this.renderLayer_(l,i))}}}}],[{key:"forEachRecursive",value:function forEachRecursive(lyr,fn){lyr.getLayers().forEach(function(lyr,idx,a){fn(lyr,idx,a);if(lyr.getLayers){LayerSwitcher.forEachRecursive(lyr,fn)}})}},{key:"uuid",value:function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}},{key:"enableTouchScroll_",value:function enableTouchScroll_(elm){if(LayerSwitcher.isTouchDevice_()){var scrollStartPos=0;elm.addEventListener("touchstart",function(event){scrollStartPos=this.scrollTop+event.touches[0].pageY},false);elm.addEventListener("touchmove",function(event){this.scrollTop=scrollStartPos-event.touches[0].pageY},false)}}},{key:"isTouchDevice_",value:function isTouchDevice_(){try{document.createEvent("TouchEvent");return true}catch(e){return false}}}]);return LayerSwitcher}(Control);if(window.ol&&window.ol.control){window.ol.control.LayerSwitcher=LayerSwitcher}return LayerSwitcher})));